{% extends "admin/base_site.html" %}
{% load i18n admin_urls static %}

{% block page_title %}Upload Multiple Images{% endblock %}

{% block extrahead %}
    {{ block.super }}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const dropZone = document.getElementById('drop-zone');
            const fileInput = document.getElementById('id_images');
            const previewContainer = document.getElementById('image-preview');
            const selectedCount = document.getElementById('selected-count');
            const uploadForm = document.getElementById('upload-form');

            // Drag and drop handlers
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            ['dragenter', 'dragover'].forEach(eventName => {
                dropZone.addEventListener(eventName, () => {
                    dropZone.classList.add('border-indigo-500', 'bg-indigo-50');
                    dropZone.classList.remove('border-gray-300');
                });
            });

            ['dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, () => {
                    dropZone.classList.remove('border-indigo-500', 'bg-indigo-50');
                    dropZone.classList.add('border-gray-300');
                });
            });

            dropZone.addEventListener('drop', function(e) {
                const dt = e.dataTransfer;
                fileInput.files = dt.files;
                updatePreview();
            });

            dropZone.addEventListener('click', function() {
                fileInput.click();
            });

            fileInput.addEventListener('change', updatePreview);

            function updatePreview() {
                previewContainer.innerHTML = '';
                const files = fileInput.files;
                
                if (files.length > 0) {
                    selectedCount.innerHTML = `
                        <div class="flex items-center">
                            <i class="fas fa-check-circle text-green-500 mr-2"></i>
                            <span class="text-green-600 font-semibold">${files.length} file(s) selected</span>
                        </div>
                    `;
                    
                    for (let i = 0; i < Math.min(files.length, 12); i++) {
                        const file = files[i];
                        if (!file.type.startsWith('image/')) continue;
                        
                        const reader = new FileReader();
                        const imageItem = document.createElement('div');
                        imageItem.className = 'relative group';
                        
                        reader.onload = function(e) {
                            imageItem.innerHTML = `
                                <div class="w-24 h-24 rounded-xl overflow-hidden border-2 border-gray-200 group-hover:border-indigo-400 transition-all">
                                    <img src="${e.target.result}" class="w-full h-full object-cover">
                                </div>
                                <div class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity rounded-xl flex items-center justify-center">
                                    <span class="text-white text-xs font-medium">${file.name.slice(0, 10)}...</span>
                                </div>
                            `;
                        };
                        
                        reader.readAsDataURL(file);
                        previewContainer.appendChild(imageItem);
                    }
                    
                    if (files.length > 12) {
                        const moreItem = document.createElement('div');
                        moreItem.className = 'w-24 h-24 rounded-xl bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center';
                        moreItem.innerHTML = `<span class="text-white font-bold text-lg">+${files.length - 12}</span>`;
                        previewContainer.appendChild(moreItem);
                    }
                } else {
                    selectedCount.innerHTML = `
                        <div class="flex items-center">
                            <i class="fas fa-info-circle text-gray-400 mr-2"></i>
                            <span class="text-gray-500">No files selected</span>
                        </div>
                    `;
                }
            }
        });
    </script>
{% endblock %}

{% block content %}
<!-- Header -->
<div class="flex items-center justify-between mb-8">
    <div>
        <h1 class="text-2xl font-bold text-gray-900 mb-2">Upload Multiple Images</h1>
        <nav class="flex items-center space-x-2 text-sm">
            <a href="{% url 'admin:index' %}" class="text-gray-500 hover:text-indigo-600">
                <i class="fas fa-home"></i>
            </a>
            <i class="fas fa-chevron-right text-gray-300"></i>
            <a href="{% url 'admin:main_galleryimage_changelist' %}" class="text-gray-500 hover:text-indigo-600">Gallery Images</a>
            <i class="fas fa-chevron-right text-gray-300"></i>
            <span class="text-indigo-600 font-medium">Upload Multiple</span>
        </nav>
    </div>
</div>

<!-- Instructions Card -->
<div class="bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-2xl p-6 mb-8">
    <div class="flex items-start">
        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-indigo-500 flex items-center justify-center mr-4 flex-shrink-0">
            <i class="fas fa-info-circle text-2xl text-white"></i>
        </div>
        <div>
            <h3 class="font-semibold text-blue-900 mb-2">Instructions</h3>
            <ul class="text-sm text-blue-800 space-y-1">
                <li><i class="fas fa-check mr-2 text-blue-500"></i>Upload multiple gallery images at once</li>
                <li><i class="fas fa-check mr-2 text-blue-500"></i>All images will be assigned to the selected category</li>
                <li><i class="fas fa-check mr-2 text-blue-500"></i>Hold <kbd class="px-2 py-0.5 bg-blue-200 rounded text-xs">Ctrl</kbd> (or <kbd class="px-2 py-0.5 bg-blue-200 rounded text-xs">âŒ˜</kbd> on Mac) to select multiple files</li>
                <li><i class="fas fa-check mr-2 text-blue-500"></i>Or drag and drop files directly into the upload zone</li>
            </ul>
        </div>
    </div>
</div>

<!-- Upload Form -->
<form id="upload-form" method="post" enctype="multipart/form-data" class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
    {% csrf_token %}
    
    <div class="p-6 border-b border-gray-100">
        <h2 class="text-lg font-bold text-gray-900 flex items-center">
            <span class="w-10 h-10 rounded-xl bg-gradient-to-br from-pink-500 to-rose-500 flex items-center justify-center mr-3">
                <i class="fas fa-images text-white"></i>
            </span>
            Upload Details
        </h2>
    </div>
    
    <div class="p-6 space-y-6">
        <!-- Form Fields -->
        {% for field in form %}
        <div>
            <label for="{{ field.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
                {{ field.label }}
                {% if field.field.required %}<span class="text-red-500">*</span>{% endif %}
            </label>
            <div class="relative">
                {% if field.name == 'category' %}
                <select name="{{ field.name }}" id="{{ field.id_for_label }}" 
                    class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all appearance-none bg-white">
                    {% for choice in field.field.choices %}
                    <option value="{{ choice.0 }}" {% if choice.0 == field.value %}selected{% endif %}>{{ choice.1 }}</option>
                    {% endfor %}
                </select>
                <div class="absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none">
                    <i class="fas fa-chevron-down text-gray-400"></i>
                </div>
                {% else %}
                <input type="text" name="{{ field.name }}" id="{{ field.id_for_label }}" value="{{ field.value|default:'' }}"
                    class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all"
                    placeholder="{{ field.help_text }}">
                {% endif %}
            </div>
            {% if field.help_text %}
            <p class="mt-2 text-sm text-gray-500">
                <i class="fas fa-info-circle mr-1"></i>{{ field.help_text }}
            </p>
            {% endif %}
            {% if field.errors %}
            <p class="mt-2 text-sm text-red-500">
                <i class="fas fa-exclamation-circle mr-1"></i>{{ field.errors.0 }}
            </p>
            {% endif %}
        </div>
        {% endfor %}
        
        <!-- File Upload Zone -->
        <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">
                Images <span class="text-red-500">*</span>
            </label>
            <div id="drop-zone" 
                class="border-2 border-dashed border-gray-300 rounded-2xl p-8 text-center cursor-pointer transition-all hover:border-indigo-400 hover:bg-indigo-50/50">
                <input type="file" name="images" id="id_images" multiple accept="image/*" class="hidden">
                <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-pink-500 to-rose-500 flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-cloud-upload-alt text-3xl text-white"></i>
                </div>
                <p class="text-gray-700 font-medium mb-1">Drop your images here</p>
                <p class="text-sm text-gray-500 mb-4">or click to browse</p>
                <span class="inline-flex items-center px-4 py-2 bg-indigo-100 text-indigo-700 rounded-full text-sm font-medium">
                    <i class="fas fa-image mr-2"></i>
                    Select Images
                </span>
            </div>
            
            <!-- Selected Files Info -->
            <div id="selected-count" class="mt-4">
                <div class="flex items-center">
                    <i class="fas fa-info-circle text-gray-400 mr-2"></i>
                    <span class="text-gray-500">No files selected</span>
                </div>
            </div>
            
            <!-- Image Preview Grid -->
            <div id="image-preview" class="flex flex-wrap gap-3 mt-4"></div>
        </div>
    </div>
    
    <!-- Submit Section -->
    <div class="bg-gray-50 px-6 py-4 flex items-center justify-between border-t border-gray-100">
        <a href="{% url 'admin:main_galleryimage_changelist' %}" class="text-gray-600 hover:text-gray-900 font-medium">
            <i class="fas fa-arrow-left mr-2"></i>Back to Gallery
        </a>
        <button type="submit" 
            class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-pink-500 to-rose-500 text-white font-semibold rounded-xl hover:from-pink-600 hover:to-rose-600 transition-all shadow-lg shadow-pink-500/25 hover:shadow-xl hover:shadow-pink-500/30 hover:-translate-y-0.5">
            <i class="fas fa-upload mr-2"></i>
            Upload Images
        </button>
    </div>
</form>
{% endblock %}
