{% extends "admin/base_site.html" %}
{% load i18n admin_urls static %}

{% block extrahead %}
    {{ block.super }}
    <style>
        .help-text {
            color: #666;
            font-size: 13px;
            margin-top: 4px;
        }
        .file-upload-container {
            margin-top: 20px;
            margin-bottom: 20px;
        }
        .alert-info {
            background-color: #d9edf7;
            border-color: #bce8f1;
            color: #31708f;
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid transparent;
            border-radius: 4px;
        }
        .image-preview {
            display: flex;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        .image-item {
            width: 100px;
            height: 100px;
            margin: 5px;
            position: relative;
            overflow: hidden;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .image-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .selected-count {
            margin-top: 10px;
            font-weight: bold;
        }
    </style>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const fileInput = document.getElementById('id_images');
            const previewContainer = document.getElementById('image-preview');
            const selectedCount = document.getElementById('selected-count');
            
            fileInput.addEventListener('change', function() {
                previewContainer.innerHTML = '';
                const files = this.files;
                
                if (files.length > 0) {
                    selectedCount.textContent = `${files.length} file(s) selected`;
                    
                    for (let i = 0; i < Math.min(files.length, 12); i++) {
                        const file = files[i];
                        if (!file.type.startsWith('image/')) continue;
                        
                        const reader = new FileReader();
                        const imageItem = document.createElement('div');
                        imageItem.className = 'image-item';
                        
                        reader.onload = function(e) {
                            const img = document.createElement('img');
                            img.src = e.target.result;
                            imageItem.appendChild(img);
                        };
                        
                        reader.readAsDataURL(file);
                        previewContainer.appendChild(imageItem);
                    }
                    
                    if (files.length > 12) {
                        const moreText = document.createElement('div');
                        moreText.textContent = `+ ${files.length - 12} more`;
                        moreText.className = 'image-item';
                        moreText.style.display = 'flex';
                        moreText.style.alignItems = 'center';
                        moreText.style.justifyContent = 'center';
                        previewContainer.appendChild(moreText);
                    }
                } else {
                    selectedCount.textContent = 'No files selected';
                }
            });
        });
    </script>
{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
<a href="{% url 'admin:index' %}">{% trans 'Home' %}</a>
&rsaquo; <a href="{% url 'admin:app_list' app_label=opts.app_label %}">{{ opts.app_config.verbose_name }}</a>
&rsaquo; <a href="{% url 'admin:main_galleryimage_changelist' %}">Gallery Images</a>
&rsaquo; Upload Multiple Images
</div>
{% endblock %}

{% block content %}
<div id="content-main">
    <div class="alert-info">
        <p><strong>Instructions:</strong> Use this form to upload multiple gallery images at once. All images will be assigned to the selected category and given sequential names based on the title prefix you provide.</p>
        <p>Hold Ctrl (or Command on Mac) while selecting to choose multiple files in the file browser.</p>
    </div>
    
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <fieldset class="module aligned">
            {% for field in form %}
                <div class="form-row">
                    <div class="field-box">
                        {{ field.errors }}
                        {{ field.label_tag }}
                        {{ field }}
                        {% if field.help_text %}
                            <div class="help-text">{{ field.help_text }}</div>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
            
            <!-- Custom file input field outside the Django form -->
            <div class="form-row">
                <div class="field-box">
                    <label for="id_images">Images:</label>
                    <input type="file" name="images" id="id_images" multiple accept="image/*" class="form-control">
                    <div class="help-text">Select multiple images to upload at once (hold Ctrl/Cmd to select multiple)</div>
                    <div id="selected-count" class="selected-count">No files selected</div>
                    <div id="image-preview" class="image-preview"></div>
                </div>
            </div>
        </fieldset>
        
        <div class="submit-row">
            <input type="submit" value="Upload Images" class="default" name="_save">
        </div>
    </form>
</div>
{% endblock %}
